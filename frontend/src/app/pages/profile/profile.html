<div class="container-fluid py-5" *ngIf="user; else requireLogin">
  <div class="row justify-content-center">
    <div class="col-12">
      <div class="profile-card">
        <div class="welcome-message">
          <h2>Welcome back, {{ user.name }}!</h2>
          <p class="text-muted">Manage your profile and view your order history below.</p>
        </div>
        <h3>Your Profile</h3>

        <div *ngIf="statusMessage" [ngClass]="statusType" class="alert my-2">
          {{ statusMessage }}
        </div>

        <div class="profile-info">
          <div *ngIf="edit">
            <div class="edit-form">
              <div class="mb-3">
                <label for="name" class="form-label">Name:</label>
                <input [(ngModel)]="user.name" id="name" type="text" name="name" class="form-control" required>
              </div>
              <div class="mb-3">
                <label for="email" class="form-label">Email:</label>
                <input [(ngModel)]="user.email" id="email" type="email" name="email" pattern="/^[^\s@]+@[^\s@]+\.[^\s@]+$/" class="form-control" required>
              </div>
              <div class="mb-3">
                <label for="phone" class="form-label">Phone:</label>
                <input [(ngModel)]="user.phone" id="phone" type="tel" name="phone" maxlength="10" pattern="/^[6-9]\d{9}$/" class="form-control">
              </div>
              <div class="d-flex gap-2">
                <button type="button" class="save-button" (click)="save()">Save Changes</button>
                <button type="button" class="btn btn-secondary" (click)="edit = false">Cancel</button>
              </div>
            </div>
          </div>

          <div *ngIf="!edit">
            <p><strong>Name:</strong> {{ user.name }}</p>
            <p><strong>Email:</strong> {{ user.email }}</p>
            <p><strong>Phone:</strong> {{ user.phone }}</p>
            <button type="button" class="edit-button" (click)="enableEdit()">Edit Profile</button>
          </div>
        </div>

        <div *ngIf="showOrders" class="orders-section">
          <h3>Your Orders</h3>
          <div *ngIf="orders.length === 0" class="alert alert-info">
            No orders found.
          </div>
          <div *ngFor="let order of orders" class="order-card">
            <h4>Order #{{ order.id }}</h4>
            <p><strong>Date:</strong> {{ order.orderDate | date:'medium' }}</p>
            <p><strong>Status:</strong> <span class="badge bg-success">{{ order.status }}</span></p>
            <p><strong>Total:</strong> ${{ order.total }}</p>
            <p><strong>Address:</strong> {{ order.address }}</p>
            <h6>Items:</h6>
            <ul class="list-group list-group-flush">
              <li *ngFor="let item of order.items" class="list-group-item d-flex justify-content-between align-items-center">
                {{ item.name }} (x{{ item.quantity }})
                <span class="badge bg-primary rounded-pill">${{ item.price * item.quantity }}</span>
              </li>
            </ul>
          </div>
        </div>

        <div class="text-center mt-4">
          <button type="button" class="view-orders-btn" (click)="toggleOrders()">
            {{ showOrders ? 'Hide Orders' : 'View Orders' }}
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<ng-template #requireLogin>
  <div class="container py-5 text-center">
    <p class="lead">Please log in to view your profile.</p>
    <a routerLink="/login" class="btn btn-success">Go to Login</a>
  </div>
</ng-template>